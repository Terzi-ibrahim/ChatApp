@model ChatApp.ViewModels.Chat.ChatViewModel

<!-- CurrentUserId'yi hidden olarak gönderiyoruz -->
<input type="hidden" id="currentUserId" value="@Model.CurrentUserId" />

<section class="vh-100 d-flex flex-column bg-light">
    <div class="container-fluid h-100 d-flex flex-column py-3">
        <div class="row flex-grow-1">

            <!-- Üyeler Listesi -->
            <div class="col-md-4 col-lg-3 mb-3 mb-md-0">
                <div class="card h-100 shadow-sm">
                    <div class="card-header bg-primary text-white fw-bold">
                        Members
                    </div>
                    <ul class="list-group list-group-flush overflow-auto" id="memberList" style="max-height: 80vh;">
                        @foreach (var user in Model.Members)
                        {
                            <li class="list-group-item d-flex justify-content-between align-items-center p-2 @(user.UnreadCount > 0 ? "bg-body-tertiary" : "")"
                                data-userid="@user.Id" data-username="@user.Name">
                                <a href="#" class="d-flex align-items-center member-item text-decoration-none text-dark w-100">
                                    <img src="@user.AvatarUrl" alt="avatar" class="rounded-circle me-2" width="50" />
                                    <div class="flex-grow-1">
                                        <div class="fw-bold">@user.Name</div>
                                        <div class="text-truncate small text-muted">@user.LastMessage</div>
                                    </div>
                                    <div class="text-end ms-2">
                                        <div class="small text-muted mb-1">@user.LastMessageTime.ToString("HH:mm")</div>
                                        @if (user.UnreadCount > 0)
                                        {
                                            <span class="badge bg-danger">@user.UnreadCount</span>
                                        }
                                    </div>
                                </a>
                            </li>
                        }
                    </ul>
                </div>
            </div>

            <!-- Chat Alanı -->
            <div class="col-md-8 col-lg-9 d-flex flex-column">
                <div class="card h-100 shadow-sm d-flex flex-column">
                    <div class="card-header bg-primary text-white fw-bold">
                        Chat
                    </div>
                    <ul class="list-unstyled flex-grow-1 overflow-auto p-3 mb-0" id="chatMessages" style="max-height: 65vh;"></ul>

                    <!-- Mesaj Gönderme Alanı -->
                    <div class="card-footer bg-light d-flex flex-column gap-2">
                        <div class="d-flex gap-2">
                            <textarea class="form-control" id="chatInput" rows="2" placeholder="Mesaj yaz..."></textarea>
                            <input type="file" class="form-control" id="chatImage" accept="image/*" />
                        </div>
                        <div class="d-flex gap-2 justify-content-end">
                            <button type="button" class="btn btn-danger" id="clearChatButton">Temizle</button>
                            <button type="button" class="btn btn-primary" id="sendButton">Gönder</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>

<!-- JS -->
<script src="~/js/chat.js" defer></script>
